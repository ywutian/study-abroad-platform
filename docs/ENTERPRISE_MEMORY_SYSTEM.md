# ğŸ§  ä¼ä¸šçº§ AI è®°å¿†ç³»ç»Ÿæ¶æ„æ–¹æ¡ˆ

> **ç‰ˆæœ¬**: v2.0  
> **å‚è€ƒ**: Mem0, LangChain Memory, OpenAI Memory API  
> **é€‚ç”¨åœºæ™¯**: ç•™å­¦ç”³è¯· AI åŠ©æ‰‹

---

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

| ç›®æ ‡       | æŒ‡æ ‡                       |
| ---------- | -------------------------- |
| **ä¸ªæ€§åŒ–** | åŸºäºè®°å¿†çš„æ¨èå‡†ç¡®ç‡ > 85% |
| **ä¸€è‡´æ€§** | è·¨ä¼šè¯ä¸Šä¸‹æ–‡ä¿æŒç‡ 100%    |
| **å®æ—¶æ€§** | è®°å¿†æ£€ç´¢å»¶è¿Ÿ < 50ms        |
| **å¯æ‰©å±•** | æ”¯æŒ 100ä¸‡+ ç”¨æˆ·è®°å¿†       |
| **åˆè§„æ€§** | GDPR/CCPA å®Œå…¨åˆè§„         |

### 1.2 æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Memory System Architecture                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Memory Lifecycle Manager                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Extract  â”‚â†’â”‚ Validate â”‚â†’â”‚  Store   â”‚â†’â”‚  Decay   â”‚â†’â”‚ Archiveâ”‚ â”‚   â”‚
â”‚  â”‚  â”‚ æå–     â”‚  â”‚ éªŒè¯     â”‚  â”‚  å­˜å‚¨    â”‚  â”‚  è¡°å‡    â”‚  â”‚ å½’æ¡£   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â–¼               â–¼               â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Memory Store (3-Tier)                          â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚  Working Memory â”‚  â”‚  Short-term     â”‚  â”‚   Long-term     â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    å·¥ä½œè®°å¿†      â”‚  â”‚   çŸ­æœŸè®°å¿†       â”‚  â”‚    é•¿æœŸè®°å¿†      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡ â”‚  â”‚  â€¢ ä¼šè¯è®°å¿†      â”‚  â”‚  â€¢ ç”¨æˆ·äº‹å®      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ å·¥å…·è°ƒç”¨çŠ¶æ€  â”‚  â”‚  â€¢ æœ€è¿‘äº¤äº’      â”‚  â”‚  â€¢ é•¿æœŸåå¥½      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ä¸´æ—¶æ¨ç†     â”‚  â”‚  â€¢ ä¸´æ—¶åå¥½      â”‚  â”‚  â€¢ æ ¸å¿ƒå†³ç­–      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚  â€¢ é‡è¦ç»å†      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  TTL: è¯·æ±‚çº§    â”‚  â”‚  TTL: 24h-7d    â”‚  â”‚  TTL: æ°¸ä¹…/å¹´    â”‚       â”‚   â”‚
â”‚  â”‚  â”‚  Storage: RAM   â”‚  â”‚  Storage: Redis â”‚  â”‚  Storage: PG    â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â–¼               â–¼               â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Memory Index Layer                             â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚  Semantic Index â”‚  â”‚  Temporal Index â”‚  â”‚  Category Index â”‚       â”‚   â”‚
â”‚  â”‚  â”‚    è¯­ä¹‰ç´¢å¼•      â”‚  â”‚    æ—¶é—´ç´¢å¼•      â”‚  â”‚    åˆ†ç±»ç´¢å¼•      â”‚       â”‚   â”‚
â”‚  â”‚  â”‚   (pgvector)    â”‚  â”‚   (B-tree)      â”‚  â”‚   (Hash)        â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€è®°å¿†åˆ†ç±»ä½“ç³»

### 2.1 è®°å¿†ç±»å‹çŸ©é˜µ

```
                    æŒä¹…æ€§
            çŸ­æš‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æŒä¹…
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   ä½   â”‚  ä¸´æ—¶çŠ¶æ€   â”‚   ä¼šè¯åå¥½    â”‚
   â†‘    â”‚  (å·¥ä½œè®°å¿†)  â”‚  (çŸ­æœŸè®°å¿†)   â”‚
é‡è¦æ€§  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â†“    â”‚  ä¸Šä¸‹æ–‡ä¿¡æ¯  â”‚   æ ¸å¿ƒäº‹å®    â”‚
   é«˜   â”‚  (å·¥ä½œè®°å¿†)  â”‚  (é•¿æœŸè®°å¿†)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è¯¦ç»†åˆ†ç±»å®šä¹‰

| å±‚çº§   | ç±»å‹     | å­˜å‚¨       | TTL     | ç¤ºä¾‹                             |
| ------ | -------- | ---------- | ------- | -------------------------------- |
| **L1** | å·¥ä½œè®°å¿† | RAM        | è¯·æ±‚çº§  | å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡ã€å·¥å…·è°ƒç”¨ä¸­é—´çŠ¶æ€ |
| **L2** | çŸ­æœŸè®°å¿† | Redis      | 1-7å¤©   | æœ€è¿‘è®¨è®ºçš„å­¦æ ¡ã€ä¸´æ—¶ä¿®æ”¹çš„åå¥½   |
| **L3** | é•¿æœŸè®°å¿† | PostgreSQL | æ°¸ä¹…/å¹´ | GPAã€SATã€EDå†³å®šã€æ ¸å¿ƒåå¥½       |

### 2.3 è®°å¿†ç±»å‹æšä¸¾

```typescript
enum MemoryType {
  // === äº‹å®å‹ (FACT) ===
  ACADEMIC_FACT = 'ACADEMIC_FACT', // GPAã€æ’åã€è¯¾ç¨‹
  TEST_SCORE_FACT = 'TEST_SCORE_FACT', // SATã€ACTã€TOEFL
  ACTIVITY_FACT = 'ACTIVITY_FACT', // æ´»åŠ¨ã€ç¤¾å›¢
  AWARD_FACT = 'AWARD_FACT', // å¥–é¡¹ã€è£èª‰
  BACKGROUND_FACT = 'BACKGROUND_FACT', // å­¦æ ¡ã€å¹´çº§ã€åœ°åŒº

  // === åå¥½å‹ (PREFERENCE) ===
  SCHOOL_PREFERENCE = 'SCHOOL_PREFERENCE', // å­¦æ ¡ç±»å‹ã€åœ°åŒºåå¥½
  MAJOR_PREFERENCE = 'MAJOR_PREFERENCE', // ä¸“ä¸šæ–¹å‘
  STYLE_PREFERENCE = 'STYLE_PREFERENCE', // æ²Ÿé€šé£æ ¼ã€å›å¤é•¿åº¦
  BUDGET_PREFERENCE = 'BUDGET_PREFERENCE', // é¢„ç®—èŒƒå›´

  // === å†³ç­–å‹ (DECISION) ===
  APPLICATION_DECISION = 'APPLICATION_DECISION', // ED/EA é€‰æ‹©
  SCHOOL_DECISION = 'SCHOOL_DECISION', // æœ€ç»ˆé€‰æ ¡
  ESSAY_DECISION = 'ESSAY_DECISION', // æ–‡ä¹¦ä¸»é¢˜ç¡®å®š

  // === å…³ç³»å‹ (RELATION) ===
  SCHOOL_RELATION = 'SCHOOL_RELATION', // ç”¨æˆ·-å­¦æ ¡å…³ç³»
  PERSON_RELATION = 'PERSON_RELATION', // æ¨èäººã€é¡¾é—®

  // === æ‘˜è¦å‹ (SUMMARY) ===
  CONVERSATION_SUMMARY = 'CONVERSATION_SUMMARY', // å¯¹è¯æ‘˜è¦
  PERIOD_SUMMARY = 'PERIOD_SUMMARY', // é˜¶æ®µæ€§æ€»ç»“
}

enum MemoryTier {
  WORKING = 'WORKING', // L1: å·¥ä½œè®°å¿†
  SHORT = 'SHORT', // L2: çŸ­æœŸè®°å¿†
  LONG = 'LONG', // L3: é•¿æœŸè®°å¿†
}
```

---

## ä¸‰ã€è®°å¿†ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 3.1 ç”Ÿå‘½å‘¨æœŸæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Memory Lifecycle                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ EXTRACT â”‚â”€â”€â”€â†’â”‚ VALIDATEâ”‚â”€â”€â”€â†’â”‚  SCORE  â”‚â”€â”€â”€â†’â”‚  STORE  â”‚â”€â”€â”€â†’â”‚  INDEX  â”‚   â”‚
â”‚   â”‚  æå–   â”‚    â”‚  éªŒè¯   â”‚    â”‚  è¯„åˆ†   â”‚    â”‚  å­˜å‚¨   â”‚    â”‚  ç´¢å¼•   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚              â”‚              â”‚              â”‚              â”‚         â”‚
â”‚        â–¼              â–¼              â–¼              â–¼              â–¼         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚è§„åˆ™å¼•æ“ â”‚    â”‚æ ¼å¼éªŒè¯ â”‚    â”‚é‡è¦æ€§   â”‚    â”‚é€‰æ‹©å­˜å‚¨å±‚â”‚    â”‚å‘é‡åŒ–   â”‚   â”‚
â”‚   â”‚+ LLM   â”‚    â”‚èŒƒå›´éªŒè¯ â”‚    â”‚æ–°é²œåº¦   â”‚    â”‚å»é‡æ£€æŸ¥ â”‚    â”‚åˆ†ç±»ç´¢å¼• â”‚   â”‚
â”‚   â”‚        â”‚    â”‚ä¸šåŠ¡éªŒè¯ â”‚    â”‚ç½®ä¿¡åº¦   â”‚    â”‚å†²çªè§£å†³ â”‚    â”‚æ—¶é—´ç´¢å¼• â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ RETRIEVEâ”‚â—„â”€â”€â”€â”‚ REINFORCEâ”‚â—„â”€â”€â”€â”‚  DECAY  â”‚â—„â”€â”€â”€â”‚ COMPRESSâ”‚â—„â”€â”€â”€â”‚ ARCHIVE â”‚   â”‚
â”‚   â”‚  æ£€ç´¢   â”‚    â”‚  å¼ºåŒ–   â”‚    â”‚  è¡°å‡   â”‚    â”‚  å‹ç¼©   â”‚    â”‚  å½’æ¡£   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚              â”‚              â”‚              â”‚              â”‚         â”‚
â”‚        â–¼              â–¼              â–¼              â–¼              â–¼         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚è¯­ä¹‰æ£€ç´¢ â”‚    â”‚è®¿é—®è®¡æ•°+1â”‚   â”‚æ—¶é—´è¡°å‡ â”‚    â”‚åˆå¹¶ç›¸ä¼¼ â”‚    â”‚å¯¼å‡ºå¤‡ä»½ â”‚   â”‚
â”‚   â”‚æ—¶é—´è¿‡æ»¤ â”‚    â”‚é‡è¦æ€§â†‘  â”‚    â”‚é‡è¦æ€§â†“  â”‚    â”‚ç”Ÿæˆæ‘˜è¦ â”‚    â”‚å†·å­˜å‚¨   â”‚   â”‚
â”‚   â”‚é‡æ’åº   â”‚    â”‚æ–°é²œåº¦â†‘  â”‚    â”‚è¿‡æœŸæ£€æŸ¥ â”‚    â”‚åˆ é™¤å†—ä½™ â”‚    â”‚GDPRåˆ é™¤ â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç”Ÿå‘½å‘¨æœŸé…ç½®

```typescript
interface MemoryLifecycleConfig {
  // === æå–é…ç½® ===
  extraction: {
    enableRuleEngine: boolean; // å¯ç”¨è§„åˆ™å¼•æ“
    enableLLMExtraction: boolean; // å¯ç”¨ LLM æå–
    minMessageLength: number; // æœ€å°æ¶ˆæ¯é•¿åº¦ (é»˜è®¤ 20)
    maxExtractionsPerMessage: number; // æ¯æ¶ˆæ¯æœ€å¤§æå–æ•° (é»˜è®¤ 5)
  };

  // === éªŒè¯é…ç½® ===
  validation: {
    strictMode: boolean; // ä¸¥æ ¼éªŒè¯æ¨¡å¼
    allowUnknownTypes: boolean; // å…è®¸æœªçŸ¥ç±»å‹
  };

  // === è¯„åˆ†é…ç½® ===
  scoring: {
    importanceWeight: number; // é‡è¦æ€§æƒé‡ (é»˜è®¤ 0.4)
    freshnessWeight: number; // æ–°é²œåº¦æƒé‡ (é»˜è®¤ 0.3)
    confidenceWeight: number; // ç½®ä¿¡åº¦æƒé‡ (é»˜è®¤ 0.3)
  };

  // === å­˜å‚¨é…ç½® ===
  storage: {
    dedupeEnabled: boolean; // å¯ç”¨å»é‡
    conflictStrategy: ConflictStrategy;
    defaultTTL: Record<MemoryTier, number>; // é»˜è®¤ TTL (ç§’)
  };

  // === è¡°å‡é…ç½® ===
  decay: {
    enabled: boolean; // å¯ç”¨è¡°å‡
    decayRate: number; // è¡°å‡ç‡ (æ¯å¤©)
    minImportance: number; // æœ€ä½é‡è¦æ€§é˜ˆå€¼
    accessBoost: number; // è®¿é—®åŠ æˆ
  };

  // === å‹ç¼©é…ç½® ===
  compression: {
    enabled: boolean; // å¯ç”¨å‹ç¼©
    triggerThreshold: number; // è§¦å‘é˜ˆå€¼ (è®°å¿†æ•°é‡)
    similarityThreshold: number; // ç›¸ä¼¼åº¦é˜ˆå€¼
  };

  // === å½’æ¡£é…ç½® ===
  archival: {
    enabled: boolean; // å¯ç”¨å½’æ¡£
    archiveAfterDays: number; // å½’æ¡£æ—¶é—´ (å¤©)
    deleteAfterDays: number; // åˆ é™¤æ—¶é—´ (å¤©)
  };
}

// é»˜è®¤é…ç½®
const DEFAULT_LIFECYCLE_CONFIG: MemoryLifecycleConfig = {
  extraction: {
    enableRuleEngine: true,
    enableLLMExtraction: true,
    minMessageLength: 20,
    maxExtractionsPerMessage: 5,
  },
  validation: {
    strictMode: true,
    allowUnknownTypes: false,
  },
  scoring: {
    importanceWeight: 0.4,
    freshnessWeight: 0.3,
    confidenceWeight: 0.3,
  },
  storage: {
    dedupeEnabled: true,
    conflictStrategy: 'KEEP_LATEST',
    defaultTTL: {
      WORKING: 0, // è¯·æ±‚çº§
      SHORT: 7 * 86400, // 7 å¤©
      LONG: 365 * 86400, // 1 å¹´
    },
  },
  decay: {
    enabled: true,
    decayRate: 0.01, // æ¯å¤©è¡°å‡ 1%
    minImportance: 0.1, // æœ€ä½ 0.1
    accessBoost: 0.05, // è®¿é—®åŠ æˆ 5%
  },
  compression: {
    enabled: true,
    triggerThreshold: 100, // è¶…è¿‡ 100 æ¡è§¦å‘å‹ç¼©
    similarityThreshold: 0.9,
  },
  archival: {
    enabled: true,
    archiveAfterDays: 180, // 180 å¤©åå½’æ¡£
    deleteAfterDays: 730, // 2 å¹´ååˆ é™¤
  },
};
```

---

## å››ã€è®°å¿†è¯„åˆ†ç³»ç»Ÿ

### 4.1 ç»¼åˆè¯„åˆ†å…¬å¼

```
MemoryScore = (Importance Ã— W_i) + (Freshness Ã— W_f) + (Confidence Ã— W_c) + AccessBonus

å…¶ä¸­:
- Importance: åŸºäºè§„åˆ™çš„é‡è¦æ€§ [0, 1]
- Freshness: æ—¶é—´æ–°é²œåº¦ = exp(-Î» Ã— days_since_creation)
- Confidence: æå–ç½®ä¿¡åº¦ [0, 1]
- AccessBonus: min(accessCount Ã— boost, 0.2)
- W_i, W_f, W_c: æƒé‡ (é»˜è®¤ 0.4, 0.3, 0.3)
```

### 4.2 é‡è¦æ€§è¯„åˆ†è§„åˆ™

```typescript
const IMPORTANCE_RULES: Record<MemoryType, ImportanceConfig> = {
  // === æ ¸å¿ƒäº‹å® (0.85-1.0) ===
  ACADEMIC_FACT: {
    base: 0.9,
    boosts: [
      { condition: 'is_gpa', boost: 0.05 },
      { condition: 'top_10_percent', boost: 0.05 },
    ],
  },
  TEST_SCORE_FACT: {
    base: 0.9,
    boosts: [
      { condition: 'sat_1500_plus', boost: 0.05 },
      { condition: 'perfect_score', boost: 0.05 },
    ],
  },

  // === å…³é”®å†³ç­– (0.9-1.0) ===
  APPLICATION_DECISION: {
    base: 0.95,
    boosts: [{ condition: 'is_ed', boost: 0.05 }],
  },

  // === ä¸€èˆ¬åå¥½ (0.5-0.7) ===
  SCHOOL_PREFERENCE: {
    base: 0.6,
    boosts: [{ condition: 'explicit_statement', boost: 0.1 }],
  },
  STYLE_PREFERENCE: {
    base: 0.5,
    boosts: [],
  },

  // === æ´»åŠ¨/å¥–é¡¹ (0.7-0.9) ===
  ACTIVITY_FACT: {
    base: 0.7,
    boosts: [
      { condition: 'leadership_role', boost: 0.1 },
      { condition: 'long_term', boost: 0.05 },
    ],
  },
  AWARD_FACT: {
    base: 0.75,
    boosts: [
      { condition: 'national_level', boost: 0.15 },
      { condition: 'international_level', boost: 0.1 },
    ],
  },
};
```

### 4.3 æ–°é²œåº¦è¡°å‡æ›²çº¿

```
æ–°é²œåº¦ Freshness(t) = exp(-Î» Ã— t)

å…¶ä¸­:
- t: è·ç¦»åˆ›å»ºçš„å¤©æ•°
- Î»: è¡°å‡ç³»æ•° (é»˜è®¤ 0.01)

ç¤ºä¾‹:
- åˆ›å»ºå½“å¤©: Freshness = 1.0
- 7 å¤©å:   Freshness = 0.93
- 30 å¤©å:  Freshness = 0.74
- 90 å¤©å:  Freshness = 0.41
- 180 å¤©å: Freshness = 0.17
- 365 å¤©å: Freshness = 0.03
```

```
     1.0 â”¤â—
         â”‚ â•²
     0.8 â”¤  â•²
         â”‚   â•²
     0.6 â”¤    â•²
         â”‚     â•²
     0.4 â”¤      â•²
         â”‚       â•²â•²
     0.2 â”¤         â•²â•²â•²
         â”‚            â•²â•²â•²___
     0.0 â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         0   30   90  180  365 (å¤©)
```

---

## äº”ã€è®°å¿†æ£€ç´¢ç³»ç»Ÿ

### 5.1 æ£€ç´¢ç­–ç•¥

```typescript
enum RetrievalStrategy {
  SEMANTIC = 'SEMANTIC', // è¯­ä¹‰æ£€ç´¢ (é»˜è®¤)
  TEMPORAL = 'TEMPORAL', // æ—¶é—´æ£€ç´¢
  CATEGORICAL = 'CATEGORICAL', // åˆ†ç±»æ£€ç´¢
  HYBRID = 'HYBRID', // æ··åˆæ£€ç´¢
}

interface RetrievalConfig {
  strategy: RetrievalStrategy;
  topK: number; // è¿”å›æ•°é‡
  minScore: number; // æœ€ä½åˆ†æ•°é˜ˆå€¼

  // è¯­ä¹‰æ£€ç´¢é…ç½®
  semantic?: {
    minSimilarity: number; // æœ€ä½ç›¸ä¼¼åº¦
    embeddingModel: string; // Embedding æ¨¡å‹
  };

  // æ—¶é—´æ£€ç´¢é…ç½®
  temporal?: {
    recentDays: number; // æœ€è¿‘ N å¤©
    prioritizeRecent: boolean; // ä¼˜å…ˆæœ€è¿‘
  };

  // åˆ†ç±»æ£€ç´¢é…ç½®
  categorical?: {
    types: MemoryType[]; // é™å®šç±»å‹
    tiers: MemoryTier[]; // é™å®šå±‚çº§
  };

  // é‡æ’åºé…ç½®
  rerank?: {
    enabled: boolean;
    model: string; // é‡æ’åºæ¨¡å‹
    diversityFactor: number; // å¤šæ ·æ€§å› å­
  };
}
```

### 5.2 æ··åˆæ£€ç´¢æµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢: "å¸®æˆ‘åˆ†æç”³è¯· MIT çš„æœºä¼š"
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Stage 1: å¹¶è¡Œæ£€ç´¢                          â”‚
â”‚                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ è¯­ä¹‰æ£€ç´¢    â”‚   â”‚ åˆ†ç±»æ£€ç´¢    â”‚   â”‚ æ—¶é—´æ£€ç´¢    â”‚        â”‚
â”‚   â”‚ "MITç”³è¯·"   â”‚   â”‚ SCHOOL_*    â”‚   â”‚ æœ€è¿‘7å¤©     â”‚        â”‚
â”‚   â”‚ Top 20     â”‚   â”‚ ACADEMIC_*  â”‚   â”‚ Top 10     â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚          â”‚                 â”‚                 â”‚               â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                            â–¼                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚              Stage 2: åˆå¹¶å»é‡                         â”‚  â”‚
â”‚   â”‚  â€¢ Union æ‰€æœ‰ç»“æœ                                      â”‚  â”‚
â”‚   â”‚  â€¢ æŒ‰ memory_id å»é‡                                   â”‚  â”‚
â”‚   â”‚  â€¢ ä¿ç•™æœ€é«˜åˆ†                                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â–¼                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚              Stage 3: è¯„åˆ†æ’åº                         â”‚  â”‚
â”‚   â”‚                                                       â”‚  â”‚
â”‚   â”‚  Score = (similarity Ã— 0.4) + (importance Ã— 0.3)      â”‚  â”‚
â”‚   â”‚        + (freshness Ã— 0.2) + (accessBonus Ã— 0.1)      â”‚  â”‚
â”‚   â”‚                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â–¼                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚              Stage 4: å¤šæ ·æ€§é‡æ’ (å¯é€‰)                 â”‚  â”‚
â”‚   â”‚                                                       â”‚  â”‚
â”‚   â”‚  â€¢ MMR (Maximal Marginal Relevance)                   â”‚  â”‚
â”‚   â”‚  â€¢ é¿å…è¿”å›è¿‡äºç›¸ä¼¼çš„è®°å¿†                               â”‚  â”‚
â”‚   â”‚                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â–¼                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚              Stage 5: è¿”å› Top-K                       â”‚  â”‚
â”‚   â”‚                                                       â”‚  â”‚
â”‚   â”‚  [                                                    â”‚  â”‚
â”‚   â”‚    { content: "GPA 3.8", score: 0.92 },               â”‚  â”‚
â”‚   â”‚    { content: "SAT 1520", score: 0.88 },              â”‚  â”‚
â”‚   â”‚    { content: "ç›®æ ‡MIT CS", score: 0.85 },            â”‚  â”‚
â”‚   â”‚    ...                                                â”‚  â”‚
â”‚   â”‚  ]                                                    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 æ£€ç´¢ä¸Šä¸‹æ–‡æ„å»º

```typescript
interface RetrievalContext {
  // === è®°å¿†æ•°æ® ===
  memories: {
    academic: MemoryRecord[]; // å­¦æœ¯ç›¸å…³
    testScores: MemoryRecord[]; // æ ‡åŒ–æˆç»©
    schools: MemoryRecord[]; // å­¦æ ¡ç›¸å…³
    activities: MemoryRecord[]; // æ´»åŠ¨å¥–é¡¹
    preferences: MemoryRecord[]; // åå¥½è®¾ç½®
    decisions: MemoryRecord[]; // å·²åšå†³ç­–
    recent: MemoryRecord[]; // æœ€è¿‘è®°å¿†
  };

  // === å®ä½“æ•°æ® ===
  entities: {
    schools: EntityRecord[]; // å…³æ³¨çš„å­¦æ ¡
    people: EntityRecord[]; // ç›¸å…³äººç‰©
    events: EntityRecord[]; // ç›¸å…³äº‹ä»¶
  };

  // === å¯¹è¯ä¸Šä¸‹æ–‡ ===
  conversation: {
    recentMessages: Message[]; // æœ€è¿‘æ¶ˆæ¯
    summary?: string; // å¯¹è¯æ‘˜è¦
    currentTopic?: string; // å½“å‰è¯é¢˜
  };

  // === ç”¨æˆ·åå¥½ ===
  preferences: UserPreferences;

  // === å…ƒæ•°æ® ===
  meta: {
    retrievalTimeMs: number;
    memoriesCount: number;
    entitiesCount: number;
  };
}
```

---

## å…­ã€è®°å¿†å»é‡ä¸å†²çª

### 6.1 å»é‡ç­–ç•¥çŸ©é˜µ

| è®°å¿†ç±»å‹                    | å»é‡é”®                        | å†²çªç­–ç•¥       | è¯´æ˜             |
| --------------------------- | ----------------------------- | -------------- | ---------------- |
| `ACADEMIC_FACT` (GPA)       | `user:{userId}:gpa`           | `KEEP_LATEST`  | ä¸€ä¸ªç”¨æˆ·ä¸€ä¸ª GPA |
| `TEST_SCORE_FACT` (SAT)     | `user:{userId}:sat`           | `KEEP_HIGHEST` | ä¿ç•™æœ€é«˜åˆ†       |
| `APPLICATION_DECISION` (ED) | `user:{userId}:ed`            | `KEEP_LATEST`  | åªèƒ½æœ‰ä¸€ä¸ª ED    |
| `SCHOOL_PREFERENCE`         | `user:{userId}:school:{name}` | `MERGE`        | åˆå¹¶åå¥½åŸå›      |
| `ACTIVITY_FACT`             | æ—                             | `KEEP_BOTH`    | æ´»åŠ¨å¯ä»¥å¤šä¸ª     |
| `CONVERSATION_SUMMARY`      | `conv:{convId}:summary`       | `KEEP_LATEST`  | æ¯å¯¹è¯ä¸€ä¸ªæ‘˜è¦   |

### 6.2 å†²çªè§£å†³ç®—æ³•

```typescript
enum ConflictStrategy {
  KEEP_LATEST = 'KEEP_LATEST', // ä¿ç•™æœ€æ–°
  KEEP_HIGHEST = 'KEEP_HIGHEST', // ä¿ç•™æœ€é«˜å€¼
  KEEP_OLDEST = 'KEEP_OLDEST', // ä¿ç•™æœ€æ—§
  MERGE = 'MERGE', // åˆå¹¶
  KEEP_BOTH = 'KEEP_BOTH', // éƒ½ä¿ç•™
  ASK_USER = 'ASK_USER', // è¯¢é—®ç”¨æˆ·
}

function resolveConflict(
  newMemory: Memory,
  existingMemory: Memory,
  strategy: ConflictStrategy
): ResolveResult {
  switch (strategy) {
    case 'KEEP_LATEST':
      return {
        action: 'REPLACE',
        memory: newMemory,
        reason: 'ä¿ç•™æœ€æ–°è®°å¿†',
      };

    case 'KEEP_HIGHEST':
      const newValue = extractNumericValue(newMemory.content);
      const existValue = extractNumericValue(existingMemory.content);
      if (newValue > existValue) {
        return {
          action: 'REPLACE',
          memory: newMemory,
          reason: `æ–°å€¼ ${newValue} > æ—§å€¼ ${existValue}`,
        };
      }
      return {
        action: 'SKIP',
        memory: existingMemory,
        reason: `æ—§å€¼ ${existValue} >= æ–°å€¼ ${newValue}`,
      };

    case 'MERGE':
      return {
        action: 'MERGE',
        memory: {
          ...existingMemory,
          content: mergeContents(existingMemory.content, newMemory.content),
          importance: Math.max(existingMemory.importance, newMemory.importance),
          updatedAt: new Date(),
        },
        reason: 'åˆå¹¶è®°å¿†å†…å®¹',
      };

    case 'KEEP_BOTH':
      return {
        action: 'ADD',
        memory: newMemory,
        reason: 'å…è®¸å¤šæ¡è®°å¿†',
      };

    case 'ASK_USER':
      return {
        action: 'PENDING',
        memory: newMemory,
        reason: 'éœ€è¦ç”¨æˆ·ç¡®è®¤',
        confirmationRequired: true,
      };
  }
}
```

---

## ä¸ƒã€è®°å¿†å‹ç¼©ä¸æ‘˜è¦

### 7.1 å‹ç¼©è§¦å‘æ¡ä»¶

```typescript
interface CompressionTrigger {
  // æ•°é‡è§¦å‘
  maxMemoriesPerUser: number; // ç”¨æˆ·è®°å¿†ä¸Šé™ (é»˜è®¤ 500)
  maxMemoriesPerCategory: number; // åˆ†ç±»è®°å¿†ä¸Šé™ (é»˜è®¤ 50)

  // ç›¸ä¼¼åº¦è§¦å‘
  similarityThreshold: number; // ç›¸ä¼¼åº¦é˜ˆå€¼ (é»˜è®¤ 0.9)
  minSimilarCount: number; // æœ€å°‘ç›¸ä¼¼æ•° (é»˜è®¤ 3)

  // æ—¶é—´è§¦å‘
  olderThanDays: number; // è¶…è¿‡ N å¤©çš„è®°å¿† (é»˜è®¤ 90)

  // å®šæ—¶è§¦å‘
  cronSchedule: string; // Cron è¡¨è¾¾å¼ (é»˜è®¤ "0 3 * * *" æ¯å¤©å‡Œæ™¨3ç‚¹)
}
```

### 7.2 å‹ç¼©æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Memory Compression Flow                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. è¯†åˆ«å‹ç¼©å€™é€‰                                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ SELECT * FROM memories                                  â”‚ â”‚
â”‚     â”‚ WHERE user_id = ? AND importance < 0.5                  â”‚ â”‚
â”‚     â”‚ AND created_at < NOW() - INTERVAL '90 days'             â”‚ â”‚
â”‚     â”‚ ORDER BY category, created_at                           â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â–¼                                     â”‚
â”‚  2. åˆ†ç»„èšç±» (æŒ‰ category + è¯­ä¹‰ç›¸ä¼¼åº¦)                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ Group 1: [æ´»åŠ¨A, æ´»åŠ¨B, æ´»åŠ¨C]  (ç›¸ä¼¼åº¦ > 0.9)           â”‚ â”‚
â”‚     â”‚ Group 2: [å­¦æ ¡åå¥½1, å­¦æ ¡åå¥½2]                          â”‚ â”‚
â”‚     â”‚ Group 3: [...]                                          â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â–¼                                     â”‚
â”‚  3. LLM ç”Ÿæˆæ‘˜è¦                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ Prompt: "å°†ä»¥ä¸‹è®°å¿†åˆå¹¶ä¸ºä¸€æ¡æ‘˜è¦ï¼Œä¿ç•™å…³é”®ä¿¡æ¯"          â”‚ â”‚
â”‚     â”‚ Input:  [æ´»åŠ¨A, æ´»åŠ¨B, æ´»åŠ¨C]                            â”‚ â”‚
â”‚     â”‚ Output: "å‚ä¸äº†3é¡¹æ´»åŠ¨ï¼šæœºå™¨äººç¤¾å›¢(ç¤¾é•¿)ã€..."            â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â–¼                                     â”‚
â”‚  4. æ›¿æ¢åŸè®°å¿†                                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ Transaction:                                            â”‚ â”‚
â”‚     â”‚   DELETE FROM memories WHERE id IN (...)                â”‚ â”‚
â”‚     â”‚   INSERT INTO memories (summary) VALUES (...)           â”‚ â”‚
â”‚     â”‚   INSERT INTO compression_log (...)                     â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 æ‘˜è¦ç”Ÿæˆ Prompt

```typescript
const COMPRESSION_PROMPT = `ä½ æ˜¯è®°å¿†å‹ç¼©ä¸“å®¶ã€‚å°†å¤šæ¡ç›¸å…³è®°å¿†åˆå¹¶ä¸ºä¸€æ¡ç²¾ç‚¼çš„æ‘˜è¦ã€‚

## åŸåˆ™
1. ä¿ç•™æ‰€æœ‰å…³é”®ä¿¡æ¯ï¼ˆæ•°å­—ã€åç§°ã€æ—¥æœŸï¼‰
2. å»é™¤é‡å¤å’Œå†—ä½™
3. ä¿æŒå®¢è§‚é™ˆè¿°
4. æ§åˆ¶åœ¨ 200 å­—ä»¥å†…

## è¾“å…¥è®°å¿†
{memories}

## è¾“å‡ºæ ¼å¼
{
  "summary": "å‹ç¼©åçš„æ‘˜è¦",
  "keyFacts": ["ä¿ç•™çš„å…³é”®äº‹å®1", "..."],
  "droppedInfo": ["ä¸¢å¼ƒçš„ä¿¡æ¯1", "..."],
  "confidence": 0.9
}`;
```

---

## å…«ã€å®‰å…¨ä¸åˆè§„

### 8.1 æ•°æ®åˆ†çº§

| çº§åˆ«        | ç±»å‹           | å­˜å‚¨è¦æ±‚   | è®¿é—®æ§åˆ¶   |
| ----------- | -------------- | ---------- | ---------- |
| **L1 å…¬å¼€** | æ²Ÿé€šåå¥½       | æ™®é€šåŠ å¯†   | ç”¨æˆ· + AI  |
| **L2 æ•æ„Ÿ** | GPAã€æˆç»©      | å­—æ®µåŠ å¯†   | ä»…ç”¨æˆ·æˆæƒ |
| **L3 éšç§** | çœŸå®å§“åã€èº«ä»½ | ç«¯åˆ°ç«¯åŠ å¯† | ä»…ç”¨æˆ·æœ¬äºº |

### 8.2 GDPR åˆè§„ API

```typescript
// è®°å¿†ç®¡ç† API
interface MemoryGDPRApi {
  // æ•°æ®è®¿é—®æƒ (Right of Access)
  listMemories(userId: string, filters?: MemoryFilters): Promise<Memory[]>;
  exportMemories(userId: string, format: 'json' | 'csv'): Promise<Blob>;

  // ä¿®æ­£æƒ (Right to Rectification)
  updateMemory(userId: string, memoryId: string, content: string): Promise<Memory>;

  // åˆ é™¤æƒ (Right to Erasure)
  deleteMemory(userId: string, memoryId: string): Promise<void>;
  deleteAllMemories(userId: string, confirmation: string): Promise<void>;

  // é™åˆ¶å¤„ç†æƒ (Right to Restriction)
  pauseMemoryExtraction(userId: string): Promise<void>;
  resumeMemoryExtraction(userId: string): Promise<void>;

  // æ•°æ®å¯æºæƒ (Right to Portability)
  exportAllData(userId: string): Promise<DataExport>;

  // åå¯¹æƒ (Right to Object)
  optOutMemory(userId: string): Promise<void>;
}

// å®¡è®¡æ—¥å¿—
interface MemoryAuditLog {
  id: string;
  userId: string;
  action: 'CREATE' | 'READ' | 'UPDATE' | 'DELETE' | 'EXPORT';
  memoryId?: string;
  details: Record<string, any>;
  ipAddress: string;
  userAgent: string;
  timestamp: Date;
}
```

### 8.3 æ•°æ®ä¿ç•™ç­–ç•¥

```yaml
# æ•°æ®ä¿ç•™é…ç½®
retention:
  # æ´»è·ƒç”¨æˆ·
  active_users:
    memories: 365 days # è®°å¿†ä¿ç•™ 1 å¹´
    conversations: 90 days # å¯¹è¯ä¿ç•™ 90 å¤©
    audit_logs: 180 days # å®¡è®¡æ—¥å¿— 180 å¤©

  # éæ´»è·ƒç”¨æˆ· (90å¤©æœªç™»å½•)
  inactive_users:
    memories: 180 days
    conversations: 30 days
    audit_logs: 90 days

  # åˆ é™¤è´¦å·å
  deleted_accounts:
    anonymized_data: 30 days # åŒ¿ååŒ–æ•°æ®ä¿ç•™ 30 å¤©
    backup: 90 days # å¤‡ä»½ä¿ç•™ 90 å¤©
    permanent_delete: 90 days # 90 å¤©åæ°¸ä¹…åˆ é™¤
```

---

## ä¹ã€å¯è§‚æµ‹æ€§

### 9.1 æŒ‡æ ‡ä½“ç³»

```typescript
interface MemoryMetrics {
  // === å®¹é‡æŒ‡æ ‡ ===
  capacity: {
    totalMemories: Gauge; // æ€»è®°å¿†æ•°
    memoriesByType: Gauge[]; // æŒ‰ç±»å‹ç»Ÿè®¡
    memoriesByTier: Gauge[]; // æŒ‰å±‚çº§ç»Ÿè®¡
    storageUsageBytes: Gauge; // å­˜å‚¨ä½¿ç”¨é‡
  };

  // === æ€§èƒ½æŒ‡æ ‡ ===
  performance: {
    extractionLatency: Histogram; // æå–å»¶è¿Ÿ
    retrievalLatency: Histogram; // æ£€ç´¢å»¶è¿Ÿ
    embeddingLatency: Histogram; // å‘é‡åŒ–å»¶è¿Ÿ
    compressionLatency: Histogram; // å‹ç¼©å»¶è¿Ÿ
  };

  // === è´¨é‡æŒ‡æ ‡ ===
  quality: {
    extractionAccuracy: Gauge; // æå–å‡†ç¡®ç‡
    retrievalRelevance: Gauge; // æ£€ç´¢ç›¸å…³æ€§
    dedupeRate: Gauge; // å»é‡ç‡
    conflictRate: Gauge; // å†²çªç‡
  };

  // === ä¸šåŠ¡æŒ‡æ ‡ ===
  business: {
    memoriesPerUser: Histogram; // ç”¨æˆ·è®°å¿†æ•°åˆ†å¸ƒ
    memoryUsageRate: Gauge; // è®°å¿†ä½¿ç”¨ç‡
    personalizationScore: Gauge; // ä¸ªæ€§åŒ–è¯„åˆ†
  };
}
```

### 9.2 å‘Šè­¦è§„åˆ™

```yaml
# Prometheus AlertManager Rules
groups:
  - name: memory_system_alerts
    rules:
      # å­˜å‚¨å®¹é‡å‘Šè­¦
      - alert: MemoryStorageHigh
        expr: memory_storage_usage_bytes / memory_storage_limit_bytes > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: 'è®°å¿†å­˜å‚¨ä½¿ç”¨ç‡è¶…è¿‡ 80%'

      # æ£€ç´¢å»¶è¿Ÿå‘Šè­¦
      - alert: MemoryRetrievalSlow
        expr: histogram_quantile(0.95, memory_retrieval_latency_bucket) > 200
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: 'P95 è®°å¿†æ£€ç´¢å»¶è¿Ÿè¶…è¿‡ 200ms'

      # æå–å¤±è´¥ç‡å‘Šè­¦
      - alert: MemoryExtractionFailureHigh
        expr: rate(memory_extraction_failures_total[5m]) / rate(memory_extraction_total[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: 'è®°å¿†æå–å¤±è´¥ç‡è¶…è¿‡ 10%'
```

### 9.3 ä»ªè¡¨ç›˜è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Memory System Dashboard                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Total Memories    â”‚  â”‚  Active Users       â”‚  â”‚  Avg per User       â”‚  â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚
â”‚  â”‚     1,234,567       â”‚  â”‚      45,678         â”‚  â”‚       27            â”‚  â”‚
â”‚  â”‚     â†‘ 5.2%          â”‚  â”‚      â†‘ 3.1%         â”‚  â”‚       â†‘ 2.3%        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Memories by Type                                                      â”‚  â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ACADEMIC_FACT (35%)              â”‚  â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ TEST_SCORE_FACT (24%)                        â”‚  â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ SCHOOL_PREFERENCE (16%)                              â”‚  â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ACTIVITY_FACT (12%)                                      â”‚  â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ DECISION (8%)                                                â”‚  â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆ OTHER (5%)                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Retrieval Latency (P95)        â”‚  â”‚  Extraction Success Rate         â”‚  â”‚
â”‚  â”‚                                 â”‚  â”‚                                 â”‚  â”‚
â”‚  â”‚  45ms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—         â”‚  â”‚  98.5% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—        â”‚  â”‚
â”‚  â”‚       â•±â•²    â•±â•²                  â”‚  â”‚        â•±â•²                       â”‚  â”‚
â”‚  â”‚      â•±  â•²  â•±  â•²                 â”‚  â”‚       â•±  â•²                      â”‚  â”‚
â”‚  â”‚     â•±    â•²â•±    â•²                â”‚  â”‚  â”€â”€â”€â”€â•±    â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚  â”‚
â”‚  â”‚  â”€â”€â•±              â•²â”€â”€           â”‚  â”‚                                 â”‚  â”‚
â”‚  â”‚  0   6   12   18   24 (hour)    â”‚  â”‚  0   6   12   18   24 (hour)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åã€å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€å®Œå–„ (1-2 å‘¨)

- [x] ä¸‰å±‚è®°å¿†æ¶æ„
- [x] è§„åˆ™å¼•æ“æå–
- [x] åŸºç¡€å»é‡
- [ ] **å®Œå–„éªŒè¯è§„åˆ™**
- [ ] **å†²çªå¤„ç†ç­–ç•¥**
- [ ] **è®°å¿†è¡°å‡æœºåˆ¶**

### Phase 2: ä¼ä¸šçº§åŠŸèƒ½ (2-3 å‘¨)

- [ ] æ··åˆæ£€ç´¢ç­–ç•¥
- [ ] è®°å¿†å‹ç¼©
- [ ] å¤šæ ·æ€§é‡æ’
- [ ] è´¨é‡è¯„ä¼°
- [ ] æŒ‡æ ‡ç›‘æ§

### Phase 3: é«˜çº§åŠŸèƒ½ (3-4 å‘¨)

- [ ] è·¨ç”¨æˆ·çŸ¥è¯†å›¾è°±
- [ ] è‡ªåŠ¨å­¦ä¹ ä¼˜åŒ–
- [ ] A/B æµ‹è¯•æ¡†æ¶
- [ ] ç®¡ç†åå°

---

## åä¸€ã€é¢„æµ‹ç³»ç»Ÿé›†æˆ (v2-ensemble, 2026-02-09)

è®°å¿†ç³»ç»Ÿå·²ä¸å½•å–é¢„æµ‹ç³»ç»Ÿæ·±åº¦é›†æˆï¼Œå®ç°åŒå‘æ•°æ®æµã€‚

### 11.1 é¢„æµ‹å‰è¯»å– (PredictionService â†’ MemoryManagerService)

| è¯»å–ç±»å‹ | è®°å¿†/å®ä½“ç±»å‹                             | API è°ƒç”¨                                                      | ç”¨é€”                   |
| -------- | ----------------------------------------- | ------------------------------------------------------------- | ---------------------- |
| å†å²é¢„æµ‹ | `DECISION` + category `school_prediction` | `recall({ types: ['DECISION'], useSemanticSearch: false })`   | è¶‹åŠ¿åˆ†æã€é‡å¤æŸ¥è¯¢æ£€æµ‹ |
| ç”¨æˆ·åå¥½ | `PREFERENCE`                              | `recall({ types: ['PREFERENCE'], useSemanticSearch: false })` | ç”³è¯·ç­–ç•¥åå¥½           |
| ä¸ªäººäº‹å® | `FACT`                                    | `recall({ types: ['FACT'], useSemanticSearch: false })`       | è¡¥å…… Profile æ´å¯Ÿ      |
| å­¦æ ¡å®ä½“ | `Entity(SCHOOL)`                          | `searchEntities({ types: ['SCHOOL'] })`                       | å…³æ³¨é¢‘æ¬¡ â†’ å¾®è°ƒ        |

> **é‡è¦**: `useSemanticSearch: false` ç¡®ä¿æŒ‰ `types` ç²¾ç¡®è¿‡æ»¤ï¼Œè€Œéè¯­ä¹‰æœç´¢ã€‚

### 11.2 é¢„æµ‹åå†™å…¥ (PredictionService â†’ MemoryManagerService)

| å†™å…¥å†…å®¹ | ç±»å‹             | Importance              | å†…å®¹æ¨¡æ¿                                                            |
| -------- | ---------------- | ----------------------- | ------------------------------------------------------------------- |
| é¢„æµ‹æ‘˜è¦ | `DECISION`       | 0.7 (é¦–æ¬¡) / 0.8 (é‡å¤) | "ä¸º {school} è¿›è¡Œäº†å½•å–é¢„æµ‹, æ¦‚ç‡: {prob}%, tier: {tier}"           |
| å­¦æ ¡å®ä½“ | `Entity(SCHOOL)` | â€”                       | `{ name, description, attributes: { predictedProbability, tier } }` |

### 11.3 è®°å¿†å¢å¼ºå¾®è°ƒ

- å½“ç”¨æˆ·å¤šæ¬¡å…³æ³¨åŒä¸€å­¦æ ¡ (Entity ä¸­æœ‰è®°å½•) â†’ æ¦‚ç‡ +1~2% (reflected demonstrated interest)
- å¾®è°ƒä¸Šé™: Â±2%
- å¾®è°ƒå€¼è®°å½•åœ¨ `engineScores.memoryAdjustment` å­—æ®µ

### 11.4 æŠ€æœ¯è¦ç‚¹

- è®°å¿†è¯»å–ä½¿ç”¨ `try/catch` åŒ…è£…ï¼Œ`MemoryManagerService` ä¸å¯ç”¨æ—¶ graceful degradation
- Entity è¡¨**ä¸å«** `embedding` åˆ—ï¼Œä½¿ç”¨ Prisma ORM å…³é”®è¯åŒ¹é…è€Œé pgvector

> å®Œæ•´é¢„æµ‹ç³»ç»Ÿæ–‡æ¡£: [PREDICTION_SYSTEM.md](PREDICTION_SYSTEM.md)

---

## é™„å½•: æ ¸å¿ƒä»£ç ç»“æ„

```
apps/api/src/modules/ai-agent/memory/
â”œâ”€â”€ types.ts                    # ç±»å‹å®šä¹‰
â”œâ”€â”€ extraction-rules.ts         # æå–è§„åˆ™å¼•æ“
â”œâ”€â”€ memory-extractor.service.ts # è®°å¿†æå–æœåŠ¡
â”œâ”€â”€ memory-manager.service.ts   # è®°å¿†ç®¡ç†å™¨
â”œâ”€â”€ memory-scorer.service.ts    # è®°å¿†è¯„åˆ†æœåŠ¡ (æ–°)
â”œâ”€â”€ memory-compressor.service.ts# è®°å¿†å‹ç¼©æœåŠ¡ (æ–°)
â”œâ”€â”€ memory-retriever.service.ts # è®°å¿†æ£€ç´¢æœåŠ¡ (æ–°)
â”œâ”€â”€ embedding.service.ts        # å‘é‡åŒ–æœåŠ¡
â”œâ”€â”€ persistent-memory.service.ts# æŒä¹…åŒ–æœåŠ¡
â”œâ”€â”€ redis-cache.service.ts      # Redis ç¼“å­˜
â”œâ”€â”€ summarizer.service.ts       # æ‘˜è¦æœåŠ¡
â””â”€â”€ user-data.service.ts        # GDPR API
```

---

_æ–‡æ¡£ç‰ˆæœ¬: v2.1 | æ›´æ–°æ—¥æœŸ: 2026-02-09_
