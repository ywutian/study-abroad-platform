pnpm exec lint-staged

# â”€â”€ i18n è‡ªåŠ¨æ ¡éªŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# å½“ web åº”ç”¨çš„æºç æˆ–ç¿»è¯‘æ–‡ä»¶æœ‰å˜åŠ¨æ—¶ï¼Œè‡ªåŠ¨è¿è¡Œ i18n æ£€æŸ¥
STAGED_FILES=$(git diff --cached --name-only)

# æ£€æŸ¥æ˜¯å¦æœ‰ apps/web çš„æºç æˆ–ç¿»è¯‘æ–‡ä»¶å˜åŠ¨
WEB_SRC_CHANGED=$(echo "$STAGED_FILES" | grep -c "^apps/web/src/" || true)

if [ "$WEB_SRC_CHANGED" -gt "0" ]; then
  echo ""
  echo "ğŸŒ Running i18n checks (source or translation files changed)..."
  echo ""

  # 1. æ£€æŸ¥æºç ä¸­ä½¿ç”¨çš„ key æ˜¯å¦åœ¨ zh.json ä¸­å­˜åœ¨
  if ! pnpm --filter web exec npx tsx scripts/check-missing-keys.ts; then
    echo ""
    echo "âŒ i18n check failed: missing translation keys detected."
    echo "   Run 'pnpm --filter web exec npx tsx scripts/check-missing-keys.ts --fix'"
    echo "   to auto-generate placeholder translations, then replace [TODO] values."
    echo ""
    exit 1
  fi

  # 2. æ£€æŸ¥ zh.json å’Œ en.json çš„ key ä¸€è‡´æ€§
  if ! pnpm --filter web exec npx tsx scripts/check-translation-keys.ts; then
    echo ""
    echo "âŒ i18n check failed: zh.json and en.json keys are inconsistent."
    echo ""
    exit 1
  fi

  # 3. æ£€æŸ¥ç¿»è¯‘å€¼çš„è¯­è¨€æ˜¯å¦æ­£ç¡®
  if ! pnpm --filter web exec npx tsx scripts/check-wrong-language.ts; then
    echo ""
    echo "âŒ i18n check failed: wrong-language translations detected."
    echo ""
    exit 1
  fi

  echo ""
  echo "âœ… i18n checks passed!"
  echo ""
fi
